<script>
const API_KEY = "apikey 5xpyQEvnvvTLPUM69V7uui:11cUxwSdipU6iVr9Wk8mVy";

/* ðŸ” ALTIN GRAMAJLARI (22 AYAR) */
const ALTIN_GRAM = {
    "24 Ayar Gram AltÄ±n": 1,
    "22 Ayar Gram AltÄ±n": 1,
    "Ã‡eyrek AltÄ±n": 1.75,
    "YarÄ±m AltÄ±n": 3.5,
    "Tam AltÄ±n": 7.2,
    "Cumhuriyet AltÄ±nÄ±": 7.2,
    "ReÅŸat AltÄ±n": 7.2,
    "Ata AltÄ±n": 7.2
};

const varliklar = [
    { ad:"24 Ayar Gram AltÄ±n", api:"Gram AltÄ±n" },
    { ad:"22 Ayar Gram AltÄ±n", api:"Gram AltÄ±n", katsayi:0.916 },
    { ad:"Ã‡eyrek AltÄ±n" },
    { ad:"YarÄ±m AltÄ±n" },
    { ad:"Tam AltÄ±n" },
    { ad:"Cumhuriyet AltÄ±nÄ±" },
    { ad:"ReÅŸat AltÄ±n" },
    { ad:"Ata AltÄ±n" },
    { ad:"USD", api:"USD" },
    { ad:"EUR", api:"EUR" },
    { ad:"Bank", manuel:true }
];

let fiyatlar = {};

/* âœ… 22 AYAR KUYUMCU ORTALAMASI */
function ortalamaFiyat(buy, sell) {
    return (buy + sell) / 2;
}

async function baslat() {

    const altinRes = await fetch(
        "https://api.collectapi.com/economy/goldPrice",
        { headers:{ authorization:"apikey "+API_KEY } }
    );
    const altinData = await altinRes.json();

    altinData.result.forEach(i=>{
        fiyatlar[i.name] = {
            buying: Number(i.buying),
            selling: Number(i.selling)
        };
    });

    const dovizRes = await fetch(
        "https://api.collectapi.com/economy/allCurrency",
        { headers:{ authorization:"apikey "+API_KEY } }
    );
    const dovizData = await dovizRes.json();

    dovizData.result.forEach(i=>{
        if(i.code === "USD" || i.code === "EUR"){
            fiyatlar[i.code] = {
                buying: Number(i.buying || i.rate),
                selling: Number(i.selling || i.rate)
            };
        }
    });

    tabloKur();
    yukle();
}

function hesapla() {
    let toplamTL = 0;
    let toplamGram = 0;

    /* ðŸ”‘ SADECE 22 AYAR ORTALAMA */
    const g22 = fiyatlar["Gram AltÄ±n"];
    const fiyat22 = ortalamaFiyat(g22.buying, g22.selling) * 0.916;

    varliklar.forEach((v,i)=>{
        const miktar = Number(document.getElementById("m"+i).value);
        if (!miktar) return;

        /* BANK */
        if (v.manuel) {
            document.getElementById("s"+i).innerText = miktar.toFixed(2)+" TL";
            toplamTL += miktar;
            return;
        }

        /* DÃ–VÄ°Z */
        if (v.api === "USD" || v.api === "EUR") {
            const f = fiyatlar[v.api];
            const tl = miktar * f.selling;
            document.getElementById("s"+i).innerText = tl.toFixed(2)+" TL";
            toplamTL += tl;
            return;
        }

        /* ðŸŸ¡ ALTIN â†’ GRAM HAVUZU */
        const gram = (ALTIN_GRAM[v.ad] || 0) * miktar;
        toplamGram += gram;

        const tl = gram * fiyat22;
        document.getElementById("s"+i).innerText = tl.toFixed(2)+" TL";
        toplamTL += tl;
    });

    document.getElementById("toplam").innerText =
        `Toplam: ${toplamTL.toFixed(2)} TL | Gram AltÄ±n: ${toplamGram.toFixed(2)} gr`;
}

baslat();
</script>
