<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>AltÄ±n & DÃ¶viz Hesaplama</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; max-width:900px; margin:auto; padding:15px; }
h2 { text-align:center; }
table { width:100%; border-collapse:collapse; margin-top:15px; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#eaeaea; }
input { width:80px; padding:5px; }
.butonlar { display:flex; gap:10px; margin-top:15px; }
button { flex:1; padding:10px; font-size:16px; }
.toplam { margin-top:20px; font-size:24px; text-align:right; font-weight:bold; }
@media (max-width:600px) { input { width:65px; } }
/* DARK MODE */
body.dark { background:#121212; color:#eaeaea; }
body.dark th { background:#1f1f1f; }
body.dark td { border-color:#333; }
body.dark input { background:#1e1e1e; color:#fff; border:1px solid #444; }
body.dark button { background:#333; color:#fff; }
</style>
</head>
<body>

<h2>AltÄ±n & DÃ¶viz Hesaplama</h2>
<button id="temaBtn" onclick="temaDegistir()">ğŸŒ™ Koyu Mod</button>

<table>
<thead>
<tr>
<th>TÃ¼r</th>
<th>Gram / Adet</th>
<th>Toplam Gram</th>
<th>Birim Fiyat (TL)</th>
<th>Tutar (TL)</th>
</tr>
</thead>
<tbody id="tablo"></tbody>
</table>

<div class="butonlar">
<button onclick="hesapla()">HESAPLA</button>
<button onclick="temizle()">TEMÄ°ZLE</button>
</div>

<div style="margin-top:15px;">
<label>Opsiyonel 22 Ayar AltÄ±n FiyatÄ± (TL): <input type="number" id="manuel22" placeholder="BoÅŸ bÄ±rak = API"></label>
</div>

<div class="toplam" id="toplam">Toplam: â€” | Gram AltÄ±n: â€”</div>
<div id="apiGuncelleme" style="margin-top:5px; text-align:right; font-size:12px; color:#555;">API Son GÃ¼ncelleme: â€”</div>

<script>
const API_KEY = "apikey 5xpyQEvnvvTLPUM69V7uui:11cUxwSdipU6iVr9Wk8mVy";

/* ğŸ” ALTIN GRAMAJLARI */
const ALTIN_GRAM = {
    "24 Ayar Gram AltÄ±n":1,
    "22 Ayar Gram AltÄ±n":1,
    "Ã‡eyrek AltÄ±n":1.75,
    "YarÄ±m AltÄ±n":3.5,
    "Tam AltÄ±n":7.2,
    "Cumhuriyet AltÄ±nÄ±":7.2,
    "ReÅŸat AltÄ±n":7.2,
    "Ata AltÄ±n":7.2
};

const varliklar = [
    { ad:"24 Ayar Gram AltÄ±n", api:"Gram AltÄ±n" },
    { ad:"22 Ayar Gram AltÄ±n", api:"Gram AltÄ±n", katsayi:0.916 },
    { ad:"Ã‡eyrek AltÄ±n" },
    { ad:"YarÄ±m AltÄ±n" },
    { ad:"Tam AltÄ±n" },
    { ad:"Cumhuriyet AltÄ±nÄ±" },
    { ad:"ReÅŸat AltÄ±n" },
    { ad:"Ata AltÄ±n" },
    { ad:"USD", api:"USD" },
    { ad:"EUR", api:"EUR" },
    { ad:"Bank", manuel:true }
];

let fiyatlar = {};
let apiUpdateTime = '';

function ortalamaFiyat(buy, sell) {
    /* %0.04 Makas hesaplamasÄ± */
    const makas = sell - buy;
    return sell - (makas * 0.04);
}

async function baslat() {
    try {
        const altinRes = await fetch("https://api.collectapi.com/economy/goldPrice", { headers:{ authorization:"apikey "+API_KEY } });
        const altinData = await altinRes.json();
        altinData.result.forEach(i=>{
            fiyatlar[i.name] = { buying:Number(i.buying), selling:Number(i.selling) };
        });
        apiUpdateTime = new Date().toLocaleString();
        document.getElementById("apiGuncelleme").innerText = "API Son GÃ¼ncelleme: "+apiUpdateTime;

        const dovizRes = await fetch("https://api.collectapi.com/economy/allCurrency", { headers:{ authorization:"apikey "+API_KEY } });
        const dovizData = await dovizRes.json();
        dovizData.result.forEach(i=>{
            if(i.code === "USD" || i.code === "EUR"){
                fiyatlar[i.code] = { buying:Number(i.buying||i.rate), selling:Number(i.selling||i.rate) };
            }
        });
        tabloKur();
        yukle();
    } catch(e) {
        console.log("API HatasÄ±", e);
    }
}

function tabloKur() {
    const t = document.getElementById("tablo");
    t.innerHTML = "";
    varliklar.forEach((v,i)=>{
        t.innerHTML += `<tr>
        <td>${v.ad}</td>
        <td><input type="number" step="0.01" id="m${i}"></td>
        <td id="tg${i}">â€”</td>
        <td id="bf${i}">â€”</td>
        <td id="s${i}">â€”</td>
        </tr>`;
    });
}

function hesapla() {
    let toplamTL=0, toplamGram=0;
    const manuel22 = Number(document.getElementById("manuel22").value) || null;
    const g22 = fiyatlar["Gram AltÄ±n"];
    const fiyat22 = manuel22 || ortalamaFiyat(g22.buying, g22.selling) * 0.916;

    varliklar.forEach((v,i)=>{
        const miktar = Number(document.getElementById("m"+i).value);
        if(!miktar) return;

        if(v.manuel){
            document.getElementById("s"+i).innerText = miktar.toFixed(2)+" TL";
            toplamTL += miktar;
            return;
        }

        let gram = ALTIN_GRAM[v.ad] || 0;
        let tl = 0, birimFiyat = 0;

        if(v.api === "USD" || v.api === "EUR"){
            const f = fiyatlar[v.api];
            tl = miktar * f.selling;
            birimFiyat = f.selling;
        } else {
            gram *= miktar;
            tl = gram * fiyat22;
            birimFiyat = fiyat22 * ALTIN_GRAM[v.ad];
            toplamGram += gram;
        }

        document.getElementById("tg"+i).innerText = gram.toFixed(2);
        document.getElementById("bf"+i).innerText = birimFiyat.toFixed(2);
        document.getElementById("s"+i).innerText = tl.toFixed(2)+" TL";
        toplamTL += tl;
    });

    document.getElementById("toplam").innerText = `Toplam: ${toplamTL.toFixed(2)} TL | Gram AltÄ±n: ${toplamGram.toFixed(2)} gr`;
}

function yukle() {
    varliklar.forEach((v,i)=>{
        const val = localStorage.getItem("m"+i);
        if(val) document.getElementById("m"+i).value = val;
    });
    const manuel22 = localStorage.getItem("manuel22");
    if(manuel22) document.getElementById("manuel22").value = manuel22;
}

function temizle() {
    varliklar.forEach((v,i)=>{
        document.getElementById("m"+i).value="";
        document.getElementById("s"+i).innerText="â€”";
        document.getElementById("tg"+i).innerText="â€”";
        document.getElementById("bf"+i).innerText="â€”";
        localStorage.removeItem("m"+i);
    });
    document.getElementById("manuel22").value="";
    localStorage.removeItem("manuel22");
    document.getElementById("toplam").innerText="Toplam: â€” | Gram AltÄ±n: â€”";
}

function temaDegistir() {
    document.body.classList.toggle("dark");
    const koyuMu=document.body.classList.contains("dark");
    localStorage.setItem("tema",koyuMu?"dark":"light");
    document.getElementById("temaBtn").innerText = koyuMu ? "â˜€ï¸ AÃ§Ä±k Mod" : "ğŸŒ™ Koyu Mod";
}

if(localStorage.getItem("tema")==="dark"){
    document.body.classList.add("dark");
    window.onload=()=> temaBtn.innerText="â˜€ï¸ AÃ§Ä±k Mod";
}

baslat();
</script>

</body>
</html>
