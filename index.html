<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>AltÄ±n & DÃ¶viz Hesaplama</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    font-family: Arial, sans-serif;
    background:#f4f4f4;
    max-width:900px;
    margin:auto;
    padding:15px;
}
h2 { text-align:center; }

table {
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
    table-layout: fixed; /* sÃ¼tunlarÄ±n kaymasÄ±nÄ± Ã¶nler */
}
th, td {
    border:1px solid #ccc;
    padding:8px;
    text-align:center;
    word-wrap: break-word;
}
th { background:#eaeaea; }

input { width:60px; padding:5px; }

.butonlar {
    display:flex;
    gap:10px;
    margin-top:15px;
}
button {
    flex:1;
    padding:10px;
    font-size:16px;
}

.toplam {
    margin-top:20px;
    font-size:24px;
    text-align:right;
    font-weight:bold;
}

@media (max-width:600px) {
    input { width:50px; }
    table { display:block; overflow-x:auto; }
}

/* DARK MODE */
body.dark {
    background:#121212;
    color:#eaeaea;
}
body.dark th { background:#1f1f1f; }
body.dark td { border-color:#333; }
body.dark input { background:#1e1e1e; color:#fff; border:1px solid #444; }
body.dark button { background:#333; color:#fff; }
</style>
</head>

<body>

<h2>AltÄ±n & DÃ¶viz Hesaplama</h2>
<button id="temaBtn" onclick="temaDegistir()">ğŸŒ™ Koyu Mod</button>

<table>
<thead>
<tr>
<th>TÃ¼r</th>
<th>Gram / Adet</th>
<th>Toplam Gram</th>
<th>Birim Fiyat (TL)</th>
<th>Tutar (TL)</th>
</tr>
</thead>
<tbody id="tablo"></tbody>
</table>

<div class="butonlar">
<button onclick="hesapla()">HESAPLA</button>
<button onclick="temizle()">TEMÄ°ZLE</button>
</div>

<div class="toplam" id="toplam">Toplam: â€”</div>
<div style="margin-top:10px;">
<label>Manuel 22 Ayar Fiyat (opsiyonel, TL): </label>
<input type="number" step="0.01" id="manuel22" placeholder="BoÅŸsa API fiyatÄ± kullanÄ±lÄ±r">
</div>
<div style="margin-top:5px;">
<span id="apiGuncelleme">API Son GÃ¼ncelleme: â€”</span>
</div>

<script>
const API_KEY = "apikey 5xpyQEvnvvTLPUM69V7uui:11cUxwSdipU6iVr9Wk8mVy";

/* ğŸ” ALTIN GRAMAJLARI (22 AYAR) */
const ALTIN_GRAM = {
    "24 Ayar Gram AltÄ±n": 1,
    "22 Ayar Gram AltÄ±n": 1,
    "18 Ayar Gram AltÄ±n": 1,   // gramÄ± 1, fiyatÄ± hesaplamada katsayÄ± ile dÃ¼zelecek
    "14 Ayar Gram AltÄ±n": 1,   // gramÄ± 1
    "Ã‡eyrek AltÄ±n": 1.75,
    "YarÄ±m AltÄ±n": 3.5,
    "Tam AltÄ±n": 7.2,
    "Cumhuriyet AltÄ±nÄ±": 7.2,
    "ReÅŸat AltÄ±n": 7.2,
    "Ata AltÄ±n": 7.2,
    "BeÅŸli AltÄ±n": 36           // 5 adet ReÅŸat veya Ata
};


/* 22 AYAR KATSAYISI (senin geleneksel fiyatÄ±na yakÄ±nlaÅŸtÄ±rma) */
const KATSAYI_22AYAR = 1.0515;

const varliklar = [
    { ad:"24 Ayar Gram AltÄ±n", api:"Gram AltÄ±n" },
    { ad:"22 Ayar Gram AltÄ±n", api:"Gram AltÄ±n", katsayi:0.916 },
    { ad:"18 Ayar Gram AltÄ±n", api:"Gram AltÄ±n", ayarKatsayi:0.750 },
    { ad:"14 Ayar Gram AltÄ±n", api:"Gram AltÄ±n", ayarKatsayi:0.583 },
    { ad:"Ã‡eyrek AltÄ±n" },
    { ad:"YarÄ±m AltÄ±n" },
    { ad:"Tam AltÄ±n" },
    { ad:"Cumhuriyet AltÄ±nÄ±" },
    { ad:"ReÅŸat AltÄ±n" },
    { ad:"Ata AltÄ±n" },
    { ad:"BeÅŸli AltÄ±n" },
    { ad:"USD", api:"USD" },
    { ad:"EUR", api:"EUR" },
    { ad:"Bank", manuel:true }
];

let fiyatlar = {};
let apiGuncellemeZamani = "";

async function baslat() {
    try {
        const altinRes = await fetch(
            "https://api.collectapi.com/economy/goldPrice",
            { headers:{ authorization:"apikey "+API_KEY } }
        );
        const altinData = await altinRes.json();
        apiGuncellemeZamani = new Date().toLocaleString();

        altinData.result.forEach(i=>{
            fiyatlar[i.name] = {
                buying: Number(i.buying),
                selling: Number(i.selling)
            };
        });

        const dovizRes = await fetch(
            "https://api.collectapi.com/economy/allCurrency",
            { headers:{ authorization:"apikey "+API_KEY } }
        );
        const dovizData = await dovizRes.json();

        dovizData.result.forEach(i=>{
            if(i.code === "USD" || i.code === "EUR"){
                fiyatlar[i.code] = {
                    buying: Number(i.buying || i.rate),
                    selling: Number(i.selling || i.rate)
                };
            }
        });

        tabloKur();
        yukle();
    } catch(e){
        console.error("API HatasÄ±:", e);
    }
}

function tabloKur() {
    const t = document.getElementById("tablo");
    t.innerHTML = "";
    varliklar.forEach((v,i)=>{
        t.innerHTML += `
        <tr>
            <td>${v.ad}</td>
            <td><input type="number" step="0.01" id="m${i}"></td>
            <td id="gram${i}">â€”</td>
            <td id="birim${i}">â€”</td>
            <td id="s${i}">â€”</td>
        </tr>`;
    });
    document.getElementById("apiGuncelleme").innerText = "API Son GÃ¼ncelleme: " + apiGuncellemeZamani;
}

function hesapla() {
    let toplamTL = 0;
    let toplamGram = 0;

    let manuelFiyat = Number(document.getElementById("manuel22").value);

    const API_ORTALAMA = fiyatlar["Gram AltÄ±n"] 
        ? (fiyatlar["Gram AltÄ±n"].buying + fiyatlar["Gram AltÄ±n"].selling)/2 * 0.916
        : 0;

    const fiyat22 = manuelFiyat || (API_ORTALAMA * KATSAYI_22AYAR);

    varliklar.forEach((v,i)=>{
        const miktar = Number(document.getElementById("m"+i).value);
        if (!miktar) {
            document.getElementById("gram"+i).innerText = "â€”";
            document.getElementById("birim"+i).innerText = "â€”";
            document.getElementById("s"+i).innerText = "â€”";
            return;
        }

        if(v.manuel){
            document.getElementById("s"+i).innerText = miktar.toFixed(2)+" TL";
            document.getElementById("gram"+i).innerText = "â€”";
            document.getElementById("birim"+i).innerText = "â€”";
            toplamTL += miktar;
            return;
        }

        if(v.api === "USD" || v.api === "EUR"){
            const f = fiyatlar[v.api];
            const tl = miktar * f.selling;
            document.getElementById("s"+i).innerText = tl.toFixed(2)+" TL";
            document.getElementById("gram"+i).innerText = "â€”";
            document.getElementById("birim"+i).innerText = f.selling.toFixed(2) + " TL";
            toplamTL += tl;
            return;
        }

// AltÄ±n
const gram = (ALTIN_GRAM[v.ad] || 0) * miktar;
toplamGram += gram;

// EÄŸer ayar katsayÄ±sÄ± varsa uygula, yoksa 1
const ayarKatsayi = v.ayarKatsayi || 1;
const fiyat = fiyat22 * ayarKatsayi;

const tl = gram * fiyat;
document.getElementById("s"+i).innerText = tl.toFixed(2)+" TL";
document.getElementById("gram"+i).innerText = gram.toFixed(2) + " gr";
document.getElementById("birim"+i).innerText = (tl/miktar).toFixed(2) + " TL";
toplamTL += tl;
    });

    document.getElementById("toplam").innerText =
        `Toplam: ${toplamTL.toFixed(2)} TL | Toplam Gram AltÄ±n: ${toplamGram.toFixed(2)} gr`;
}

function yukle() {
    varliklar.forEach((v,i)=>{
        const val = localStorage.getItem("m"+i);
        if(val) document.getElementById("m"+i).value = val;
    });
    const manuelVal = localStorage.getItem("manuel22");
    if(manuelVal) document.getElementById("manuel22").value = manuelVal;
}

function temizle() {
    varliklar.forEach((v,i)=>{
        document.getElementById("m"+i).value = "";
        document.getElementById("s"+i).innerText = "â€”";
        document.getElementById("gram"+i).innerText = "â€”";
        document.getElementById("birim"+i).innerText = "â€”";
        localStorage.removeItem("m"+i);
    });
    document.getElementById("manuel22").value = "";
    localStorage.removeItem("manuel22");
    document.getElementById("toplam").innerText = "Toplam: â€”";
}

function temaDegistir() {
    document.body.classList.toggle("dark");
    const koyuMu = document.body.classList.contains("dark");
    localStorage.setItem("tema", koyuMu ? "dark" : "light");
    document.getElementById("temaBtn").innerText =
        koyuMu ? "â˜€ï¸ AÃ§Ä±k Mod" : "ğŸŒ™ Koyu Mod";
}

if (localStorage.getItem("tema") === "dark") {
    document.body.classList.add("dark");
    window.onload = () => temaBtn.innerText = "â˜€ï¸ AÃ§Ä±k Mod";
}

baslat();
</script>

</body>
</html>
