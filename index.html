<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Altın & Döviz Hesaplama</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    font-family: Arial, sans-serif;
    background:#f4f4f4;
    max-width:900px;
    margin:auto;
    padding:15px;
}
h2 { text-align:center; }

table {
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
}
th, td {
    border:1px solid #ccc;
    padding:8px;
    text-align:center;
}
th { background:#eaeaea; }

input {
    width:80px;
    padding:5px;
}

.butonlar {
    display:flex;
    gap:10px;
    margin-top:15px;
}
button {
    flex:1;
    padding:10px;
    font-size:16px;
}

.toplam {
    margin-top:20px;
    font-size:24px;
    text-align:right;
    font-weight:bold;
}

/* Mobil */
@media (max-width:600px) {
    table, thead, tbody, tr, th, td {
        font-size:14px;
    }
    input {
        width:65px;
    }
}
</style>
</head>

<body>

<h2>Altın & Döviz Hesaplama</h2>

<table>
<thead>
<tr>
<th>Tür</th>
<th>Gram / Adet</th>
<th>Tutar (TL)</th>
</tr>
</thead>
<tbody id="tablo"></tbody>
</table>

<div class="butonlar">
<button onclick="hesapla()">HESAPLA</button>
<button onclick="temizle()">TEMİZLE</button>
</div>

<div class="toplam" id="toplam">Toplam: —</div>

<script>
const API_KEY = "apikey 5xpyQEvnvvTLPUM69V7uui:11cUxwSdipU6iVr9Wk8mVy";

const varliklar = [
    { ad:"24 Ayar Gram Altın", api:"Gram Altın" },
    { ad:"22 Ayar Gram Altın", api:"Gram Altın", katsayi:0.916 },
    { ad:"Çeyrek Altın", api:"Çeyrek Altın" },
    { ad:"Yarım Altın", api:"Yarım Altın" },
    { ad:"Tam Altın", api:"Tam Altın" },
    { ad:"Cumhuriyet Altını", api:"Cumhuriyet Altını" },
    { ad:"Ata Altın", api:"Ata Altın" },
    { ad:"USD", api:"USD/TRY" },
    { ad:"EUR", api:"EUR/TRY" }
];

let fiyatlar = {};

async function baslat() {
    const res = await fetch("https://api.collectapi.com/economy/allCurrency", {
        headers:{ authorization:"apikey "+API_KEY }
    });
    const data = await res.json();

    data.result.forEach(i => {
        fiyatlar[i.name] = Number(i.selling);
    });

    tabloKur();
    yukle();
}

function tabloKur() {
    const t = document.getElementById("tablo");
    t.innerHTML = "";
    varliklar.forEach((v,i)=>{
        t.innerHTML += `
        <tr>
            <td>${v.ad}</td>
            <td><input type="number" step="0.01" id="m${i}"></td>
            <td id="s${i}">—</td>
        </tr>`;
    });
}

function hesapla() {
    let toplam = 0;
    varliklar.forEach((v,i)=>{
        const miktar = Number(document.getElementById("m"+i).value);
        let fiyat = fiyatlar[v.api];

        if(v.katsayi) fiyat *= v.katsayi;

        if(miktar && fiyat){
            const tutar = miktar * fiyat;
            document.getElementById("s"+i).innerText = tutar.toFixed(2)+" TL";
            toplam += tutar;
            localStorage.setItem("m"+i, miktar);
        } else {
            document.getElementById("s"+i).innerText = "—";
        }
    });
    document.getElementById("toplam").innerText =
        "Toplam: " + toplam.toFixed(2) + " TL";
}

function yukle() {
    varliklar.forEach((v,i)=>{
        const val = localStorage.getItem("m"+i);
        if(val) document.getElementById("m"+i).value = val;
    });
}

function temizle() {
    varliklar.forEach((v,i)=>{
        document.getElementById("m"+i).value = "";
        document.getElementById("s"+i).innerText = "—";
        localStorage.removeItem("m"+i);
    });
    document.getElementById("toplam").innerText = "Toplam: —";
}

baslat();
</script>

</body>
</html>
